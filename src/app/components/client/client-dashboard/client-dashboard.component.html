<div class="min-h-screen w-full bg-gradient-to-br from-[#EFF6FF] to-[#F0FDF4]">
    <!-- Backdrop/Overlay -->
    <div *ngIf="showAdvancedFilter" (click)="toggleAdvancedFilter()"
        class="fixed inset-0 bg-black bg-opacity-10 z-40 transition-opacity duration-200">
    </div>

    <div class="flex min-h-screen">
        <app-client-sidebar></app-client-sidebar>
        <div class="flex-1 ml-20 p-4 md:max-xl:ml-64 md:max-xl:pl-2 md:py-6 xl:ml-72 xl:pl-6 2xl:pl-16 overflow-y-auto">
            <!-- Header -->
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 md:gap-4 mb-4">
                <div>
                    <h1 class="text-lg sm:text-xl md:text-2xl font-bold text-[#172B4D]">Tableau de bord</h1>
                    <div class="flex items-center gap-2 mt-2 md:mt-3 text-xs text-[#868E96]">
                        <span>Pages</span>
                        <span><svg width="6" height="10" viewBox="0 0 6 10" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M0.634658 1.3869L1.34199 0.680238L5.19466 4.53157C5.25676 4.59328 5.30605 4.66667 5.33968 4.7475C5.37331 4.82833 5.39063 4.91502 5.39063 5.00257C5.39063 5.09012 5.37331 5.17681 5.33968 5.25764C5.30605 5.33847 5.25676 5.41186 5.19466 5.47357L1.34199 9.3269L0.635325 8.62024L4.25132 5.00357L0.634658 1.3869Z"
                                    fill="#333399" />
                            </svg>
                        </span>
                        <span class="text-xs text-[#868E96]]">Tableau de bord</span>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 relative">
                    <button
                        class="flex items-center justify-center sm:justify-start gap-2 px-3 md:px-4 py-2.5 md:py-3 border border-gray-200 rounded-lg bg-white text-[#172B4D] text-xs md:text-sm font-medium">
                        <!-- Placeholder SVG calendrier -->
                        <svg width="16" height="16" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"
                            class="w-4 h-4 md:w-[18px] md:h-[18px] flex-shrink-0">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M4.625 0.875C4.97018 0.875 5.25 1.15482 5.25 1.5V2.75H12.75V1.5C12.75 1.15482 13.0298 0.875 13.375 0.875C13.7202 0.875 14 1.15482 14 1.5V2.75H14.625C16.0057 2.75 17.125 3.86929 17.125 5.25V14.625C17.125 16.0057 16.0057 17.125 14.625 17.125H3.375C1.99429 17.125 0.875 16.0057 0.875 14.625V5.25C0.875 3.86929 1.99429 2.75 3.375 2.75H4V1.5C4 1.15482 4.27982 0.875 4.625 0.875ZM15.875 8.375C15.875 7.68464 15.3154 7.125 14.625 7.125H3.375C2.68464 7.125 2.125 7.68464 2.125 8.375V14.625C2.125 15.3154 2.68464 15.875 3.375 15.875H14.625C15.3154 15.875 15.875 15.3154 15.875 14.625V8.375Z"
                                fill="#777777" />
                        </svg>

                        <span class="truncate">Cette semaine</span>
                        <!-- Placeholder SVG chevron -->
                        <svg width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg"
                            class="flex-shrink-0">
                            <path d="M1.33331 1L5.99998 5.66667L10.6666 1" stroke="#777777" stroke-width="1.33333"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>

                    </button>
                    <button (click)="toggleAdvancedFilter()"
                        class="flex items-center justify-center sm:justify-start gap-2 px-3 md:px-4 py-2.5 md:py-3 border border-gray-200 rounded-lg bg-white text-[#172B4D] text-xs md:text-sm font-medium hover:bg-gray-50 transition">
                        <!-- Placeholder SVG filtre -->
                        <svg width="16" height="12" viewBox="0 0 18 12" fill="none" xmlns="http://www.w3.org/2000/svg"
                            class="w-4 h-3 md:w-[18px] md:h-3 flex-shrink-0">
                            <path d="M4 6H14M1.5 1H16.5M6.5 11H11.5" stroke="#344054" stroke-width="1.67"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>

                        <span class="truncate">Filtrer avancé</span>
                    </button>

                    <!-- Overlay assombri -->
                    <div *ngIf="showAdvancedFilter" (click)="cancelFilters()"
                        class="fixed inset-0 bg-black bg-opacity-0 z-40"></div>

                    <!-- Advanced Filter Dropdown -->
                    <div *ngIf="showAdvancedFilter"
                        class="fixed sm:absolute top-0 sm:top-full left-0 sm:left-auto right-0 bottom-0 sm:bottom-auto sm:mt-6 w-full sm:w-[420px] md:w-[480px] bg-white sm:rounded-xl border-t sm:border border-gray-200 p-4 md:p-6 z-50 shadow-lg overflow-y-auto">
                        <h3 class="text-base md:text-lg font-bold text-[#172B4D] mb-4">Filtre avancé</h3>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4 mb-4">
                            <!-- Période -->
                            <div>
                                <label
                                    class="block text-xs md:text-sm font-medium text-[#4B4848] mb-1.5 md:mb-2">Période</label>
                                <div class="relative">
                                    <select
                                        style="appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: none;"
                                        class="w-full px-3 md:px-4 py-2.5 md:py-3 text-xs md:text-sm border border-gray-200 rounded-lg bg-white text-[#4B4848] cursor-pointer focus:ring-2 focus:ring-[#0D823B] focus:border-transparent outline-none">
                                        <option>Tous</option>
                                        <option>Aujourd'hui</option>
                                        <option>Cette semaine</option>
                                        <option>Ce mois</option>
                                        <option>Cette année</option>
                                    </select>
                                    <!-- Placeholder SVG chevron -->
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
                                        <svg width="12" height="7" viewBox="0 0 12 7" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1.33331 1L5.99998 5.66667L10.6666 1" stroke="#777777"
                                                stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Type de bien -->
                            <div>
                                <label class="block text-xs md:text-sm font-medium text-[#4B4848] mb-1.5 md:mb-2">Type
                                    de bien</label>
                                <div class="relative">
                                    <select
                                        style="appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: none;"
                                        class="w-full px-3 md:px-4 py-2.5 md:py-3 text-xs md:text-sm border border-gray-200 rounded-lg bg-white text-[#4B4848] cursor-pointer focus:ring-2 focus:ring-[#0D823B] focus:border-transparent outline-none">
                                        <option>Tous</option>
                                        <option>Immobilier</option>
                                        <option>Restaurant</option>
                                        <option>Commerce</option>
                                        <option>Autre</option>
                                    </select>
                                    <!-- Placeholder SVG chevron -->
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
                                        <svg width="12" height="7" viewBox="0 0 12 7" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1.33331 1L5.99998 5.66667L10.6666 1" stroke="#777777"
                                                stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Statut de demande -->
                            <div>
                                <label class="block text-xs md:text-sm font-medium text-[#4B4848] mb-1.5 md:mb-2">Statut
                                    de demande</label>
                                <div class="relative">
                                    <select
                                        style="appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: none;"
                                        class="w-full px-3 md:px-4 py-2.5 md:py-3 text-xs md:text-sm border border-gray-200 rounded-lg bg-white text-[#4B4848] cursor-pointer focus:ring-2 focus:ring-[#0D823B] focus:border-transparent outline-none">
                                        <option>Tous</option>
                                        <option>En attente</option>
                                        <option>En cours</option>
                                        <option>Validée</option>
                                        <option>Rejetée</option>
                                    </select>
                                    <!-- Placeholder SVG chevron -->
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
                                        <svg width="12" height="7" viewBox="0 0 12 7" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1.33331 1L5.99998 5.66667L10.6666 1" stroke="#777777"
                                                stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Statut du certificat -->
                            <div>
                                <label class="block text-xs md:text-sm font-medium text-[#4B4848] mb-1.5 md:mb-2">Statut
                                    du
                                    certificat</label>
                                <div class="relative">
                                    <select
                                        style="appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: none;"
                                        class="w-full px-3 md:px-4 py-2.5 md:py-3 text-xs md:text-sm border border-gray-200 rounded-lg bg-white text-[#4B4848] cursor-pointer focus:ring-2 focus:ring-[#0D823B] focus:border-transparent outline-none">
                                        <option>Tous</option>
                                        <option>Valide</option>
                                        <option>Expiré</option>
                                        <option>Expire bientôt</option>
                                    </select>
                                    <!-- Placeholder SVG chevron -->
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
                                        <svg width="12" height="7" viewBox="0 0 12 7" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1.33331 1L5.99998 5.66667L10.6666 1" stroke="#777777"
                                                stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row justify-end gap-2 md:gap-3 mt-4 md:mt-0">
                            <button (click)="cancelFilters()"
                                class="px-4 md:px-6 py-2.5 text-xs md:text-sm text-[#4B4848] font-medium hover:bg-gray-100 rounded-lg transition">
                                Annuler
                            </button>
                            <button (click)="applyFilters()"
                                class="px-4 md:px-6 py-2.5 text-xs md:text-sm bg-[#0D823B] text-white font-medium rounded-lg hover:bg-[#0A6B2F] transition">
                                Appliquer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stat Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4">
                <!-- Cartes dynamiques via *ngFor -->
                <div *ngFor="let card of statsCards"
                    class="bg-white rounded-lg md:rounded-xl p-4 md:p-5 flex flex-col gap-2">
                    <div class="flex items-center justify-between gap-2">
                        <div>
                            <p class="text-xs font-medium text-[#8392AB] mb-1">{{ card.title }}</p>
                            <h3 class="text-lg md:text-xl font-medium text-[#172B4D]">{{ card.value }}</h3>
                        </div>
                        <div class="w-9 h-9 md:w-10 md:h-10 {{ card.bgColor }} rounded-full flex items-center justify-center flex-shrink-0"
                            [innerHTML]="getSafeHtml(card.icon)">
                        </div>
                    </div>

                    <div class="flex items-center gap-2 text-xs {{ card.trend.color }} mt-2 md:mt-4">
                        <span [innerHTML]="getTrendArrowSvg(card.trend.isPositive)"></span>
                        {{ card.trend.value }}
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-4">
                <!-- Bar Chart -->
                <div class="bg-white rounded-lg md:rounded-xl p-4 md:p-6 shadow-sm">
                    <h2 class="text-sm md:text-base font-medium text-[#172B4D] mb-6 md:mb-12">Répartition par
                        certificats</h2>
                    <div class="w-full h-40 md:h-48">
                        <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="barChartType">
                        </canvas>
                    </div>
                </div>

                <!-- Pie Chart -->
                <div class="bg-white rounded-lg md:rounded-xl p-4 md:p-6 shadow-sm">
                    <h2 class="text-sm md:text-base font-medium text-[#172B4D] mb-4">Répartition par status</h2>
                    <div class="w-full flex items-center justify-center">
                        <!-- Chart Container: large pour les légendes, hauteur fixe pour le cercle -->
                        <div class="w-full max-w-[280px] md:max-w-[340px] h-[200px] md:h-[240px]">
                            <canvas baseChart [data]="pieChartData" [options]="pieChartOptions" [type]="pieChartType">
                            </canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tables Section -->
            <div class="mt-4 grid grid-cols-1 xl:grid-cols-3 gap-3 md:gap-4">
                <!-- Paiements récents -->
                <div class="xl:col-span-2 bg-white rounded-lg md:rounded-xl py-4 md:py-6 shadow-sm">
                    <h2 class="text-sm md:text-base font-bold text-[#172B4D] px-3 md:px-4 mb-3 md:mb-4">Paiements
                        récents</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-[600px]">
                            <thead>
                                <tr class="border-b border-gray-100 bg-[#F4F7FE]">
                                    <th class="text-left py-2 md:py-3 px-2 md:px-3 text-xs font-medium text-[#2C3E50]">
                                        Intitulé</th>
                                    <th class="text-left py-2 md:py-3 px-2 md:px-3 text-xs font-medium text-[#2C3E50]">
                                        Montant (Fcfa)
                                    </th>
                                    <th class="text-left py-2 md:py-3 px-2 md:px-3 text-xs font-medium text-[#2C3E50]">
                                        Date</th>
                                    <th class="text-left py-2 md:py-3 px-2 md:px-3 text-xs font-medium text-[#2C3E50]">
                                        Statut</th>
                                    <th class="text-left py-2 md:py-3 px-2 md:px-3 text-xs font-medium text-[#2C3E50]">
                                        Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Lignes dynamiques via *ngFor -->
                                <tr *ngFor="let payment of payments; let last = last"
                                    [class]="last ? 'hover:bg-gray-50 transition' : 'border-b border-gray-50 hover:bg-gray-50 transition'">
                                    <td class="py-3 md:py-4 px-2 md:px-3">
                                        <div class="flex items-center gap-2 md:gap-3">
                                            <div class="w-8 h-8 md:w-10 md:h-10 rounded-lg {{ payment.iconBg }} flex items-center justify-center flex-shrink-0"
                                                [innerHTML]="getSafeHtml(payment.iconSvg)">
                                            </div>
                                            <div class="min-w-0">
                                                <div class="font-semibold text-[#172B4D] text-xs md:text-sm truncate">{{
                                                    payment.title }}
                                                </div>
                                                <div class="text-xs text-[#6B7280] truncate">{{ payment.reference }}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="py-3 md:py-4 px-2 md:px-3 text-xs md:text-sm font-medium text-[#4B4848]">
                                        {{ payment.amount }}</td>
                                    <td class="py-3 md:py-4 px-2 md:px-3 text-xs md:text-sm text-[#4B4848]">{{
                                        payment.date }}</td>
                                    <td class="py-3 md:py-4 px-2 md:px-3">
                                        <span
                                            class="px-2 md:px-3 py-1 rounded-full text-xs font-medium {{ payment.statusColor }} whitespace-nowrap">
                                            {{ payment.status }}
                                        </span>
                                    </td>
                                    <td class="py-3 md:py-4 px-2 md:px-3">
                                        <button class="text-[#0D823B] hover:text-[#0A6B2F]">
                                            <svg width="12" height="12" viewBox="0 0 14 14" fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="w-3 h-3 md:w-[14px] md:h-[14px]">
                                                <path
                                                    d="M7 10.577L3.461 7.039L4.169 6.319L6.5 8.65V0H7.5V8.65L9.83 6.32L10.539 7.039L7 10.577ZM1.616 14C1.15533 14 0.771 13.846 0.463 13.538C0.155 13.23 0.000666667 12.8453 0 12.384V9.961H1V12.384C1 12.538 1.064 12.6793 1.192 12.808C1.32 12.9367 1.461 13.0007 1.615 13H12.385C12.5383 13 12.6793 12.936 12.808 12.808C12.9367 12.68 13.0007 12.5387 13 12.384V9.961H14V12.384C14 12.8447 13.846 13.229 13.538 13.537C13.23 13.845 12.8453 13.9993 12.384 14H1.616Z"
                                                    fill="#0D823B" />
                                            </svg>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Mes Certificats -->
                <div class="xl:col-span-1 bg-white rounded-lg md:rounded-xl p-4 md:p-5 shadow-sm">
                    <h2 class="text-sm md:text-base font-bold text-[#4B4848] mb-3 md:mb-4">Mes Certificats</h2>
                    <div class="space-y-1 md:space-y-2">
                        <div *ngFor="let cert of certificates"
                            class="flex items-center justify-between py-3 md:py-4 rounded-lg border-b border-gray-100 hover:bg-gray-50 transition">
                            <div class="flex items-center gap-2 md:gap-3 min-w-0 flex-1">
                                <div class="w-8 h-8 md:w-10 md:h-10 rounded-lg {{ cert.iconBg }} flex items-center justify-center flex-shrink-0"
                                    [innerHTML]="getSafeHtml(cert.iconSvg)">
                                </div>
                                <div class="min-w-0">
                                    <div class="font-semibold text-[#4B4848] text-xs md:text-sm truncate">{{ cert.title
                                        }}</div>
                                    <div class="text-xs md:text-sm text-[#6B7280] truncate">{{ cert.type }}</div>
                                </div>
                            </div>
                            <span
                                class="px-2 md:px-3 py-1 rounded-full text-xs {{ cert.statusBg }} {{ cert.statusColor }} whitespace-nowrap ml-2">{{
                                cert.status }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alertes et Notifications -->
            <div class="mt-4 bg-white rounded-lg md:rounded-xl p-4 md:p-6 shadow-sm">
                <h2 class="text-sm md:text-base font-bold text-[#172B4D] mb-4">Alertes et Notifications</h2>
                <div class="space-y-1 md:space-y-2">
                    <div *ngFor="let alert of alerts"
                        class="flex items-start justify-between py-2 md:py-3 rounded-lg border-b border-gray-100 hover:bg-gray-50 transition gap-2">
                        <div class="flex items-start gap-2 md:gap-4 flex-1 min-w-0">
                            <div class="w-8 h-8 md:w-10 md:h-10 rounded-lg {{ alert.iconBg }} flex items-center justify-center flex-shrink-0"
                                [innerHTML]="getSafeHtml(alert.iconSvg)">
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="font-semibold text-[#4B4848] text-xs md:text-sm mb-1">{{ alert.title }}
                                </div>
                                <div class="text-xs text-[#6B7280]">{{ alert.message }}</div>
                            </div>
                        </div>
                        <div class="text-xs text-[#6B7280] whitespace-nowrap flex-shrink-0">{{ alert.time }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>